const eletivas = [
    { nome: "Programa√ß√£o Web", vagas: 20, alunos: [], icon: "üíª" },
    { nome: "Rob√≥tica e Inova√ß√£o", vagas: 20, alunos: [], icon: "ü§ñ" },
    { nome: "Empreendedorismo Sustent√°vel", vagas: 20, alunos: [], icon: "üå±" },
    { nome: "Artes e Cultura Popular", vagas: 20, alunos: [], icon: "üé®" },
    { nome: "Ci√™ncia e Tecnologia", vagas: 20, alunos: [], icon: "üî¨" },
    { nome: "Educa√ß√£o Financeira", vagas: 20, alunos: [], icon: "üí∞" }
];

const alunosGerais = [];

const loginScreen = document.getElementById("login-screen");
const mainScreen = document.getElementById("main-screen");
const listaScreen = document.getElementById("lista-screen");
const entrarBtn = document.getElementById("entrar-btn");
const nomeAlunoInput = document.getElementById("nomeAluno");
const serieAlunoInput = document.getElementById("serieAluno");
const welcomeText = document.getElementById("welcome");
const eletivasList = document.getElementById("eletivas-list");
const confirmarBtn = document.getElementById("confirmar-btn");
const mensagem = document.getElementById("mensagem");
const loginError = document.getElementById("login-error");
const eletivaNome = document.getElementById("eletiva-nome");
const vagasInfo = document.getElementById("vagas-info");
const alunosLista = document.getElementById("alunos-lista");
const sairBtn = document.getElementById("sair-btn");
const toggleThemeBtn = document.getElementById("toggle-theme");

const adminPanel = document.getElementById("admin-panel");
const adminListas = document.getElementById("admin-listas");
const fecharAdminBtn = document.getElementById("fechar-admin");

let alunoAtual = null;
let serieAtual = null;
let eletivaEscolhida = null;
let selectedCard = null;

// ===== LOGIN =====
entrarBtn.addEventListener("click", () => {
    const nome = nomeAlunoInput.value.trim();
    const serie = serieAlunoInput.value;
    if (!nome || !serie) {
        loginError.textContent = "Preencha todos os campos obrigat√≥rios!";
        return;
    }
    alunoAtual = nome;
    serieAtual = serie;
    loginScreen.classList.add("hidden");
    mainScreen.classList.remove("hidden");
    welcomeText.textContent = `Bem-vindo(a), ${alunoAtual} (${serieAtual})!`;
    renderEletivas();
});

// Renderiza√ß√£o de Eletivas
function renderEletivas() {
    eletivasList.innerHTML = "";
    eletivas.forEach((eletiva, idx) => {
        const card = document.createElement("div");
        card.className = `eletiva-card ${eletiva.vagas === 0 ? 'disabled' : ''}`;
        
        const isLowVagas = eletiva.vagas > 0 && eletiva.vagas <= 5;
        const vagasClass = isLowVagas ? 'low-vagas' : '';
        
        card.innerHTML = `
            <input type="radio" name="eletiva" id="eletiva${idx}" value="${idx}" ${eletiva.vagas === 0 ? "disabled" : ""}>
            <label for="eletiva${idx}" class="eletiva-label">
                <div class="eletiva-icon">${eletiva.icon}</div>
                <div class="eletiva-name">${eletiva.nome}</div>
                <div class="eletiva-vagas ${vagasClass}">${eletiva.vagas} vaga(s)</div>
            </label>
        `;
        
        const radio = card.querySelector('input[type="radio"]');
        radio.addEventListener('change', (e) => {
            if (e.target.checked) {
                // Remove sele√ß√£o anterior
                if (selectedCard) {
                    selectedCard.classList.remove('selected');
                }
                // Adiciona sele√ß√£o atual
                card.classList.add('selected');
                selectedCard = card;
                
                // Efeito visual de confirma√ß√£o
                card.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    card.style.transform = '';
                }, 150);
            }
        });
        
        // Efeito hover mesmo sem sele√ß√£o
        card.addEventListener('mouseenter', () => {
            if (!card.classList.contains('disabled') && !card.classList.contains('selected')) {
                card.style.transform = 'translateY(-3px) scale(1.02)';
            }
        });
        
        card.addEventListener('mouseleave', () => {
            if (!card.classList.contains('disabled') && !card.classList.contains('selected')) {
                card.style.transform = '';
            }
        });
        
        eletivasList.appendChild(card);
    });
}

// Confirmar Escolha
confirmarBtn.addEventListener("click", () => {
    const selecionada = document.querySelector('input[name="eletiva"]:checked');
    if (!selecionada) {
        mensagem.textContent = "Escolha uma eletiva!";
        mensagem.style.animation = 'shake 0.5s ease-in-out';
        setTimeout(() => mensagem.style.animation = '', 500);
        return;
    }
    const idx = parseInt(selecionada.value);
    eletivaEscolhida = eletivas[idx];
    if (eletivaEscolhida.vagas <= 0) {
        mensagem.textContent = "Eletiva cheia, escolha outra!";
        return;
    }
    
    // Efeito visual de confirma√ß√£o
    confirmarBtn.style.transform = 'scale(0.95)';
    setTimeout(() => {
        confirmarBtn.style.transform = '';
    }, 150);
    
    eletivaEscolhida.alunos.push({ nome: alunoAtual, serie: serieAtual });
    eletivaEscolhida.vagas--;
    alunosGerais.push({ nome: alunoAtual, serie: serieAtual, eletiva: eletivaEscolhida.nome });
    
    setTimeout(() => {
        mainScreen.classList.add("hidden");
        listaScreen.classList.remove("hidden");
        renderLista();
    }, 300);
});

// Renderiza lista de alunos na eletiva
function renderLista() {
    eletivaNome.textContent = `Eletiva: ${eletivaEscolhida.nome}`;
    vagasInfo.textContent = `Vagas restantes: ${eletivaEscolhida.vagas}`;
    alunosLista.innerHTML = "";
    eletivaEscolhida.alunos.forEach((aluno, index) => {
        const li = document.createElement("li");
        li.textContent = `${aluno.nome} (${aluno.serie})`;
        li.dataset.serie = aluno.serie;
        
        // Efeito de entrada sequencial
        li.style.opacity = '0';
        li.style.transform = 'translateX(-20px)';
        setTimeout(() => {
            li.style.transition = 'all 0.4s ease';
            li.style.opacity = '1';
            li.style.transform = 'translateX(0)';
        }, index * 100);
        
        alunosLista.appendChild(li);
    });
}

// Sair
sairBtn.addEventListener("click", () => {
    // Efeito de sa√≠da
    listaScreen.style.opacity = '1';
    let opacity = 1;
    const fadeOut = setInterval(() => {
        opacity -= 0.05;
        listaScreen.style.opacity = opacity;
        if (opacity <= 0) {
            clearInterval(fadeOut);
            listaScreen.classList.add("hidden");
            loginScreen.classList.remove("hidden");
            listaScreen.style.opacity = '1';
        }
    }, 30);
    
    nomeAlunoInput.value = "";
    serieAlunoInput.value = "";
    alunoAtual = null;
    serieAtual = null;
    eletivaEscolhida = null;
    selectedCard = null;
});

// Tema
toggleThemeBtn.addEventListener("click", () => {
    document.body.classList.toggle("dark-mode");
    toggleThemeBtn.style.transform = 'rotate(180deg)';
    setTimeout(() => {
        toggleThemeBtn.style.transform = '';
    }, 300);
});

// ====== PAINEL ADMIN ======
document.addEventListener("keydown", (e) => {
    if (e.ctrlKey && e.shiftKey && e.code === "KeyA") {
        toggleAdminPanel();
    }
});

function toggleAdminPanel() {
    const visivel = !adminPanel.classList.contains("hidden");
    if (visivel) {
        adminPanel.classList.add("hidden");
    } else {
        renderAdmin();
        adminPanel.classList.remove("hidden");
    }
}

fecharAdminBtn.addEventListener("click", () => {
    adminPanel.classList.add("hidden");
});

// Renderiza todas as listas no painel admin
function renderAdmin() {
    adminListas.innerHTML = "";
    eletivas.forEach(eletiva => {
        const div = document.createElement("div");
        div.className = "admin-box";

        const titulo = document.createElement("h3");
        titulo.textContent = `${eletiva.nome} - Vagas restantes: ${eletiva.vagas}`;
        div.appendChild(titulo);

        const lista = document.createElement("ul");
        eletiva.alunos.forEach((aluno, index) => {
            const li = document.createElement("li");
            li.textContent = `${aluno.nome} (${aluno.serie})`;
            li.dataset.serie = aluno.serie;
            
            // Efeito de entrada
            li.style.opacity = '0';
            li.style.transform = 'translateY(-10px)';
            setTimeout(() => {
                li.style.transition = 'all 0.3s ease';
                li.style.opacity = '1';
                li.style.transform = 'translateY(0)';
            }, index * 50);
            
            lista.appendChild(li);
        });

        div.appendChild(lista);
        adminListas.appendChild(div);
    });
}

// Adicionar anima√ß√£o de shake para erros
const style = document.createElement('style');
style.textContent = `
    @keyframes shake {
        0%, 100% { transform: translateX(0); }
        25% { transform: translateX(-5px); }
        75% { transform: translateX(5px); }
    }
`;
document.head.appendChild(style);
